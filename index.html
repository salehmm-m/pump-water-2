<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>محاسبه قدرت پمپ آب مناسب ساختمان</title>

  <style>
    body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            direction: rtl;
            text-align: right;
            box-sizing: border-box;
            color: #333; /* Default text color */
        }
        .custom-pump-calculator-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh; /* Changed to vh for better vertical centering on smaller content */
            padding: 20px;
            box-sizing: border-box;
        }
        .custom-calculator-inner-pump {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            text-align: right;
            box-sizing: border-box;
        }
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 2px solid #e0e0e0; /* Added for visual separation */
            padding-bottom: 15px; /* Added for spacing below border */
        }
        .custom-form-group {
            margin-bottom: 20px;
            text-align: right;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: bold;
            cursor: pointer;
        }
        input[type="number"] {
            width: calc(100% - 20px);
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            text-align: right;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="number"]:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.2);
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%; /* Make button full width */
            margin-top: 20px; /* Space above button */
        }
        button:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        .custom-result-pump {
            margin-top: 30px;
            padding: 15px;
            background-color: #e9f7ef;
            border: 1px solid #d4edda;
            border-radius: 8px;
            color: #155724;
            font-size: 1.1em; /* Adjusted font size */
            font-weight: bold;
            text-align: right;
        }
        .custom-result-pump p {
            margin: 0; /* Remove default paragraph margin */
            line-height: 1.5; /* Improve readability */
        }
        .custom-disclaimer-pump {
            margin-top: 25px;
            font-size: 0.9em;
            color: #7f8c8d;
            text-align: justify;
            line-height: 1.6;
        }
        .error-message {
            color: #dc3545;
            margin-top: 10px;
            font-size: 0.9em;
            text-align: center;
            display: none; /* Hidden by default */
        }
  </style>

  
</head>
<body>
  <div class="custom-pump-calculator-container">
        <div class="custom-calculator-inner-pump">
            <h2>محاسبه قدرت پمپ آب مناسب ساختمان</h2>

            <div class="custom-form-group">
                <label for="floors-pump">تعداد طبقات ساختمان:</label>
                <input id="floors-pump" min="1" type="number" value="1" />
                <small style="display: block; color: #666; font-size: 0.85em; margin-top: 5px;">تعداد کل طبقات (شامل همکف). برای کولرهای آبی در پشت‌بام، یک طبقه اضافی به این عدد اضافه کنید.</small>
            </div>

            <div class="custom-form-group">
                <label for="units-pump">تعداد واحدها در هر طبقه:</label>
                <input id="units-pump" min="1" type="number" value="1" />
                <small style="display: block; color: #666; font-size: 0.85em; margin-top: 5px;">تعداد واحدهای مسکونی یا تجاری موجود در هر طبقه.</small>
            </div>

            <button onclick="calculatePumpPowerCustom()">محاسبه</button>

            <p class="error-message" id="errorMessage">لطفاً تعداد طبقات و واحدها را با اعداد مثبت و معتبر وارد کنید.</p>

            <div class="custom-result-pump" id="result-pump">
                <p>قدرت پمپ پیشنهادی: <strong>--- اسب بخار</strong></p>
                <p id="pump-type-suggestion">نوع پمپ پیشنهادی: ---</p>
                <p id="flow-suggestion">دبی مورد نیاز: --- لیتر بر دقیقه</p>
                <p id="head-suggestion">هد مورد نیاز: --- متر</p>
                <p id="recommendations-summary" style="font-weight: normal; font-size: 0.9em; margin-top: 10px;"></p>
            </div>

            <p class="custom-disclaimer-pump">
                *این محاسبه صرفاً یک تخمین اولیه بوده و بر اساس فاکتورهای عمومی انجام می‌شود. برای انتخاب دقیق و نهایی پمپ، لازم است با یک متخصص تأسیسات یا شرکت‌های فعال در زمینه پمپ و آبرسانی مشورت کنید. عواملی مانند فشار آب ورودی شهری، قطر لوله‌ها، متراژ کل ساختمان، میزان مصرف آب در ساعات اوج و نیاز به بوستر پمپ می‌توانند در انتخاب نهایی موثر باشند.
            </p>
        </div>
    </div>

  <script>
    function calculatePumpPowerCustom() {
            const floorsInput = document.getElementById('floors-pump');
            const unitsInput = document.getElementById('units-pump');
            let floors = parseInt(floorsInput.value);
            const units = parseInt(unitsInput.value);
            const errorMessage = document.getElementById('errorMessage');

            // Input validation
            if (isNaN(floors) || floors < 1 || isNaN(units) || units < 1) {
                errorMessage.style.display = 'block';
                document.getElementById('result-pump').innerHTML = `<p>قدرت پمپ پیشنهادی: <strong>--- اسب بخار</strong></p>
                                                                     <p id="pump-type-suggestion">نوع پمپ پیشنهادی: ---</p>
                                                                     <p id="flow-suggestion">دبی مورد نیاز: --- لیتر بر دقیقه</p>
                                                                     <p id="head-suggestion">هد مورد نیاز: --- متر</p>
                                                                     <p id="recommendations-summary" style="font-weight: normal; font-size: 0.9em; margin-top: 10px;"></p>`;
                return;
            } else {
                errorMessage.style.display = 'none';
            }

            // --- Constants for Calculation ---
            const METERS_PER_FLOOR = 3.2; // meters per floor
            const PRESSURE_AT_TOP_BAR = 1.5; // Desired pressure at highest point in Bar
            const PRESSURE_AT_TOP_METERS = PRESSURE_AT_TOP_BAR * 10; // Convert Bar to Meters (1 Bar approx 10m water column)

            // Approximate friction loss (accounting for non-ideal piping, bends, valves, etc.)
            // A common rule of thumb for typical residential systems is 10-20% of vertical lift for friction or a fixed amount per unit/floor.
            // Let's use a dynamic friction based on total vertical pipe length + some fixed loss.
            const FRICTION_LOSS_PER_METER = 0.05; // 0.05 meters head loss per meter of pipe (including equivalent lengths for fittings)
            const BASE_HORIZONTAL_PIPE_LENGTH_PER_FLOOR = 8; // meters of horizontal pipe equivalent per floor
            const FIXED_SYSTEM_LOSS_METERS = 5; // Fixed loss for main valves, meter, etc.

            // Flow (Dabbi) in Liters per Minute (LPM) per fixture/unit based on common usage
            // These are more realistic base flows compared to just 8-12 LPM.
            const FLOW_PER_UNIT_NORMAL_LPM = 15; // Average flow for basic fixtures in one unit
            const FLOW_PER_UNIT_HIGH_LPM = 25; // Higher flow for multiple simultaneous uses or specific fixtures

            // Diversity Factor (Hunter's Curve concept simplified): Not all fixtures/units are used simultaneously.
            // As the number of units increases, the peak simultaneous demand (diversity factor) decreases per unit.
            let diversityFactor;
            const totalUnits = floors * units;

            if (totalUnits === 1) diversityFactor = 1.0;
            else if (totalUnits <= 3) diversityFactor = 0.8;
            else if (totalUnits <= 6) diversityFactor = 0.7;
            else if (totalUnits <= 10) diversityFactor = 0.6;
            else diversityFactor = 0.5;

            // Pump Efficiency - average for residential pumps
            const PUMP_EFFICIENCY = 0.65; // 65%

            // --- 1. Calculate Head (متر) ---
            // Add 1 virtual floor for rooftop cooling if present
            const effectiveFloorsForHead = floors + 1;

            const verticalLift = effectiveFloorsForHead * METERS_PER_FLOOR;
            
            // Estimate total pipe length (vertical + horizontal equivalent)
            const estimatedTotalPipeLength = (verticalLift * 1.5) + (floors * units * BASE_HORIZONTAL_PIPE_LENGTH_PER_FLOOR); // 1.5 for slight vertical winding + horizontal per unit
            const frictionLoss = estimatedTotalPipeLength * FRICTION_LOSS_PER_METER + FIXED_SYSTEM_LOSS_METERS;
            
            let totalHeadMeters = verticalLift + PRESSURE_AT_TOP_METERS + frictionLoss;

            // If high pressure usage, add an extra buffer
            if (document.querySelector('input[name="usageType"]:checked').value === 'high') {
                totalHeadMeters *= 1.2; // 20% more head for high-pressure systems
            }

            // Ensure a reasonable minimum head for any pressurized system
            if (totalHeadMeters < 25) totalHeadMeters = 25; // Minimum 2.5 bar equivalent

            // --- 2. Calculate Flow (لیتر بر دقیقه) ---
            let baseFlowLPM = 0;
            if (document.querySelector('input[name="usageType"]:checked').value === 'normal') {
                baseFlowLPM = totalUnits * FLOW_PER_UNIT_NORMAL_LPM;
            } else {
                baseFlowLPM = totalUnits * FLOW_PER_UNIT_HIGH_LPM;
            }

            let totalFlowLPM = baseFlowLPM * diversityFactor;

            // Ensure a minimum flow for very small systems
            if (totalFlowLPM < 20) totalFlowLPM = 20; // Minimum for basic kitchen/bathroom use

            // --- 3. Calculate Power (اسب بخار) ---
            // Hydraulic Power (kW) = (Flow_m3_per_sec * Head_meters * Density_kg_per_m3 * g) / 1000
            // Simplified: (Flow_LPM / 60000) * Head_meters * 1000 (density) * 9.81 (g) / 1000
            // = (Flow_LPM * Head_meters * 9.81) / 60000
            const flow_m3_per_sec = totalFlowLPM / 60000; // Convert LPM to m³/s
            const density_water = 1000; // kg/m³
            const g = 9.81; // m/s²

            const hydraulicPower_kW = (flow_m3_per_sec * totalHeadMeters * density_water * g) / 1000;
            const inputPower_kW = hydraulicPower_kW / PUMP_EFFICIENCY;
            let pumpPowerHP = inputPower_kW / 0.746; // Convert kW to HP

            // --- Adjust pumpPowerHP to common commercial sizes and provide a range ---
            let recommendedHPRange = "";
            let recommendedPumpType = "";
            let recommendationsSummary = "";
            let specificRecommendation = "";

            // Defining common HP ranges and their suitable pump types
            // This is a more refined version of the previous if-else logic.
            if (pumpPowerHP <= 0.75) {
                recommendedHPRange = "0.75 تا 1 اسب بخار";
                recommendedPumpType = "پمپ بشقابی یا محیطی (معمولاً تک پروانه)";
                specificRecommendation = `برای ${floors} طبقه و ${totalUnits} واحد، یک پمپ با توان **${recommendedHPRange}** مناسب است.`;
                recommendationsSummary = `توصیه می‌شود از یک **منبع ذخیره آب ${Math.ceil(totalUnits * 150 / 100) * 100} لیتری** و **منبع انبساط 24 تا 50 لیتری** به همراه **ست کنترل یا کلید اتوماتیک** استفاده کنید.`;

            } else if (pumpPowerHP <= 1.5) {
                recommendedHPRange = "1 تا 1.5 اسب بخار";
                recommendedPumpType = "پمپ بشقابی (تک یا دو پروانه)";
                specificRecommendation = `برای ${floors} طبقه و ${totalUnits} واحد، یک پمپ با توان **${recommendedHPRange}** انتخاب خوبی است.`;
                recommendationsSummary = `توصیه می‌شود از یک **منبع ذخیره آب ${Math.ceil(totalUnits * 200 / 100) * 100} لیتری** و **منبع انبساط 50 تا 80 لیتری** به همراه **کلید اتوماتیک با منبع انبساط یا ست کنترل هوشمند** استفاده کنید.`;

            } else if (pumpPowerHP <= 2.5) {
                recommendedHPRange = "2 تا 2.5 اسب بخار";
                recommendedPumpType = "پمپ دو پروانه یا سانتریفیوژ تک مرحله‌ای";
                specificRecommendation = `برای ${floors} طبقه و ${totalUnits} واحد، پمپ با توان **${recommendedHPRange}** توصیه می‌شود.`;
                recommendationsSummary = `توصیه می‌شود از یک **منبع ذخیره آب ${Math.ceil(totalUnits * 250 / 100) * 100} لیتری** و **منبع انبساط 80 تا 120 لیتری** به همراه **سیستم پرشر سوئیچ و اینورتر (درایو دور متغیر)** برای بهینه‌سازی مصرف انرژی استفاده کنید.`;

            } else if (pumpPowerHP <= 4) {
                recommendedHPRange = "3 تا 4 اسب بخار";
                recommendedPumpType = "پمپ سانتریفیوژ چند مرحله‌ای یا بوستر پمپ تک پمپ";
                specificRecommendation = `برای ${floors} طبقه و ${totalUnits} واحد، پمپ با توان **${recommendedHPRange}** مناسب است.`;
                recommendationsSummary = `توصیه می‌شود از یک **منبع ذخیره آب ${Math.ceil(totalUnits * 300 / 100) * 100} لیتری (و یا بیشتر)** و **منبع انبساط بالای 100 لیتر** به همراه **بوستر پمپ دور متغیر** استفاده کنید تا فشار آب پایدار و مصرف انرژی بهینه داشته باشید.`;

            } else { // For higher HP needs, indicating larger/more complex buildings
                recommendedHPRange = "5 اسب بخار به بالا";
                recommendedPumpType = "سیستم بوستر پمپ (شامل دو یا چند پمپ با اینورتر)";
                specificRecommendation = `برای ${floors} طبقه و ${totalUnits} واحد، نیاز به یک **سیستم بوستر پمپ** با توان **${recommendedHPRange}** می‌باشد.`;
                recommendationsSummary = `**مشاوره با متخصص:** حتماً با یک مهندس تأسیسات برای طراحی و انتخاب دقیق **سیستم بوستر پمپ دور متغیر**، محاسبه دقیق حجم منبع ذخیره آب و منبع انبساط، و طراحی لوله‌کشی مشورت کنید. حجم منبع آب برای این تعداد واحد ممکن است **بالای 2000 لیتر** باشد.`;
            }

            // Update the display
            document.getElementById('result-pump').innerHTML = `
                <p>قدرت پمپ پیشنهادی: <strong>${recommendedHPRange}</strong></p>
                <p id="pump-type-suggestion">نوع پمپ پیشنهادی: ${recommendedPumpType}</p>
                <p id="flow-suggestion">دبی مورد نیاز: ${totalFlowLPM.toFixed(1)} لیتر بر دقیقه</p>
                <p id="head-suggestion">هد مورد نیاز: ${totalHeadMeters.toFixed(1)} متر (${(totalHeadMeters / 10).toFixed(1)} بار)</p>
                <p id="recommendations-summary" style="font-weight: normal; font-size: 0.9em; margin-top: 10px;">
                    ${specificRecommendation}<br>
                    ${recommendationsSummary}
                </p>
            `;
        }
  </script>
</body>
</html>
